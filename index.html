<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplikasi Obrolan AI</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts for Inter -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" />
  <!-- React & ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel Standalone CDN for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      overflow: hidden;
    }
    .prose-invert p {
      color: #e5e7eb;
    }
    .prose-invert {
      color: #d1d5db;
    }
    #root {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100vw;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse-delay-1 { animation-delay: 0.2s; }
    .animate-pulse-delay-2 { animation-delay: 0.4s; }
  </style>
</head>
<body class="bg-gray-900 text-white flex flex-col font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // Replikasi komponen UI menggunakan Tailwind CSS
    const Button = React.forwardRef(({ className, variant, size, ...props }, ref) => {
      let baseClasses = "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-300 disabled:pointer-events-none disabled:opacity-50";
      
      if (variant === "outline") {
        baseClasses += " border border-gray-600 bg-transparent text-gray-300 hover:bg-gray-700";
      } else if (variant === "ghost") {
        baseClasses += " hover:bg-gray-800 hover:text-white";
      } else {
        baseClasses += " bg-blue-600 text-white hover:bg-blue-700";
      }

      if (size === "sm") {
        baseClasses += " h-8 px-3 py-1";
      } else {
        baseClasses += " h-10 px-4 py-2";
      }

      return (
        <button
          className={`${baseClasses} ${className}`}
          ref={ref}
          {...props}
        />
      );
    });

    const Input = React.forwardRef(({ className, type, ...props }, ref) => {
      return (
        <input
          type={type}
          className={`flex h-10 w-full rounded-md border border-gray-600 bg-gray-700 px-3 py-2 text-sm text-white placeholder-gray-400 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-gray-300 disabled:cursor-not-allowed disabled:opacity-50 ${className}`}
          ref={ref}
          {...props}
        />
      );
    });

    const Card = ({ className, ...props }) => (
      <div className={`rounded-lg border bg-card text-card-foreground shadow-sm ${className}`} {...props} />
    );

    const CardContent = ({ className, ...props }) => (
      <div className={`p-6 ${className}`} {...props} />
    );

    // Ikon SVG
    const BotIcon = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 11l-3 3-3-3"/></svg>
    );
    const UserIcon = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    );
    const SendIcon = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4 20-7z"/><path d="M22 2 11 13"/></svg>
    );
    const ImageIcon = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
    );
    const Trash2Icon = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
    );
    const CopyIcon = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
    );
    const SparklesIcon = (props) => (
      <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 12h4"/><path d="M17 12h4"/></svg>
    );

    const App = () => {
      const [messages, setMessages] = useState([
        {
          id: '1',
          role: 'assistant',
          content: 'Halo! Saya adalah AI pintar yang siap membantu Anda mengerjakan dan menjawab semua pertanyaan. Apa yang ingin Anda tanyakan hari ini?',
          timestamp: new Date()
        }
      ]);
      const [inputText, setInputText] = useState('');
      const [selectedImage, setSelectedImage] = useState(null);
      const [imagePreview, setImagePreview] = useState(null);
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState(null);
      
      const messagesEndRef = useRef(null);
      const fileInputRef = useRef(null);

      const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      };

      useEffect(() => {
        scrollToBottom();
      }, [messages]);

      const handleImageSelect = (e) => {
        const file = e.target.files?.[0];
        if (file) {
          setSelectedImage(file);
          const reader = new FileReader();
          reader.onload = () => {
            setImagePreview(reader.result);
          };
          reader.readAsDataURL(file);
        }
      };

      const removeImage = () => {
        setSelectedImage(null);
        setImagePreview(null);
        if (fileInputRef.current) {
          fileInputRef.current.value = '';
        }
      };

      const convertImageToBase64 = (file) => {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      };

      const sendMessage = async () => {
        if (!inputText.trim() && !selectedImage) return;

        const userMessage = {
          id: Date.now().toString(),
          role: 'user',
          content: inputText || 'Analisis gambar ini',
          image: imagePreview || undefined,
          timestamp: new Date()
        };

        setMessages(prev => [...prev, userMessage]);
        setInputText('');
        setIsLoading(true);
        setError(null);
        removeImage();

        try {
          const parts = [];
          if (inputText.trim()) {
            parts.push({ text: inputText });
          }

          let base64Image;
          if (selectedImage) {
            base64Image = await convertImageToBase64(selectedImage);
            const mimeType = base64Image.split(';')[0].split(':')[1];
            const base64Data = base64Image.split(',')[1];
            parts.push({ inlineData: { mimeType, data: base64Data } });
          }

          const apiKey = "";
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

          const payload = {
            contents: [{ role: "user", parts: parts }],
          };

          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          
          if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
          }
          
          const data = await response.json();
          const aiResponse = data?.candidates?.[0]?.content?.parts?.[0]?.text || 'Maaf, saya tidak dapat memberikan respons saat ini.';

          const assistantMessage = {
            id: (Date.now() + 1).toString(),
            role: 'assistant',
            content: aiResponse,
            timestamp: new Date()
          };

          setMessages(prev => [...prev, assistantMessage]);

        } catch (err) {
          setError('Terjadi kesalahan saat menghubungi AI. Silakan coba lagi.');
          console.error('API Error:', err);
        } finally {
          setIsLoading(false);
        }
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      };

      const clearChat = () => {
        setMessages([
          {
            id: '1',
            role: 'assistant',
            content: 'Chat telah dibersihkan. Apa yang ingin Anda tanyakan?',
            timestamp: new Date()
          }
        ]);
      };

      const copyToClipboard = (text) => {
        const el = document.createElement('textarea');
        el.value = text;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
      };

      const formatTime = (date) => {
        return date.toLocaleTimeString('id-ID', {  
          hour: '2-digit',  
          minute: '2-digit'  
        });
      };

      const MainApp = () => (
        <div className="min-h-screen bg-gray-900 text-white flex flex-col font-sans">
          {/* Header */}
          <div className="bg-gray-800 border-b border-gray-700 p-4 sticky top-0 z-10">
            <div className="max-w-4xl mx-auto flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                  <SparklesIcon className="w-5 h-5 text-white" />
                </div>
                <div>
                  <h1 className="text-xl font-bold">AI Pintar</h1>
                  <p className="text-sm text-gray-400">Assistant cerdas untuk semua pertanyaan</p>
                </div>
              </div>
              <Button 
                onClick={clearChat}
                variant="outline" 
                size="sm"
                className="border-gray-600 text-gray-300 hover:bg-gray-700"
              >
                <Trash2Icon className="w-4 h-4 mr-2" />
                Clear
              </Button>
            </div>
          </div>

          {/* Chat Messages */}
          <div className="flex-1 overflow-y-auto p-4">
            <div className="max-w-4xl mx-auto space-y-6">
              {messages.map((message) => (
                <div
                  key={message.id}
                  className={`flex gap-4 ${message.role === 'user' ? 'flex-row-reverse' : 'flex-row'}`}
                >
                  {/* Avatar */}
                  <div className={`w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center ${
                    message.role === 'user' 
                      ? 'bg-blue-600' 
                      : 'bg-gradient-to-r from-purple-500 to-pink-600'
                  }`}>
                    {message.role === 'user' ? (
                      <UserIcon className="w-4 h-4 text-white" />
                    ) : (
                      <BotIcon className="w-4 h-4 text-white" />
                    )}
                  </div>

                  {/* Message Content */}
                  <div className={`flex-1 max-w-3xl ${message.role === 'user' ? 'flex justify-end' : ''}`}>
                    <Card className={`${
                      message.role === 'user' 
                        ? 'bg-blue-600 border-blue-500' 
                        : 'bg-gray-800 border-gray-700'
                    }`}>
                      <CardContent className="p-4">
                        {message.image && (
                          <div className="mb-3">
                            <img 
                              src={message.image} 
                              alt="User uploaded content for AI analysis"
                              className="max-w-xs rounded-lg border border-gray-600"
                            />
                          </div>
                        )}
                        <div className="prose prose-invert max-w-none">
                          <p className="text-white whitespace-pre-wrap leading-relaxed">
                            {message.content}
                          </p>
                        </div>
                        <div className="flex items-center justify-between mt-3 pt-3 border-t border-gray-600">
                          <span className="text-xs text-gray-400">
                            {formatTime(message.timestamp)}
                          </span>
                          {message.role === 'assistant' && (
                            <Button
                              onClick={() => copyToClipboard(message.content)}
                              variant="ghost"
                              size="sm"
                              className="h-6 text-gray-400 hover:text-white"
                            >
                              <CopyIcon className="w-3 h-3" />
                            </Button>
                          )}
                        </div>
                      </CardContent>
                    </Card>
                  </div>
                </div>
              ))}

              {isLoading && (
                <div className="flex gap-4">
                  <div className="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-pink-600 flex items-center justify-center">
                    <BotIcon className="w-4 h-4 text-white" />
                  </div>
                  <Card className="bg-gray-800 border-gray-700 flex-1">
                    <CardContent className="p-4">
                      <div className="flex items-center gap-2">
                        <div className="flex gap-1">
                          <div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                          <div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse animate-pulse-delay-1"></div>
                          <div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse animate-pulse-delay-2"></div>
                        </div>
                        <span className="text-gray-400 text-sm">AI sedang berpikir...</span>
                      </div>
                    </CardContent>
                  </Card>
                </div>
              )}

              {error && (
                <div className="flex gap-4">
                  <div className="w-8 h-8 rounded-full bg-red-600 flex items-center justify-center">
                    <BotIcon className="w-4 h-4 text-white" />
                  </div>
                  <Card className="bg-red-900 border-red-700 flex-1">
                    <CardContent className="p-4">
                      <p className="text-red-200">{error}</p>
                    </CardContent>
                  </Card>
                </div>
              )}

              <div ref={messagesEndRef} />
            </div>
          </div>

          {/* Input Area */}
          <div className="bg-gray-800 border-t border-gray-700 p-4">
            <div className="max-w-4xl mx-auto">
              {/* Image Preview */}
              {imagePreview && (
                <div className="mb-4 relative inline-block">
                  <img 
                    src={imagePreview} 
                    alt="Preview of selected image for AI analysis"
                    className="max-h-32 rounded-lg border border-gray-600"
                  />
                  <Button
                    onClick={removeImage}
                    variant="ghost"
                    size="sm"
                    className="absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 rounded-full w-6 h-6 p-0 text-lg"
                  >
                    ×
                  </Button>
                </div>
              )}

              <div className="flex items-end gap-3">
                <input
                  type="file"
                  ref={fileInputRef}
                  onChange={handleImageSelect}
                  accept="image/*"
                  className="hidden"
                />
                
                <Button
                  onClick={() => fileInputRef.current?.click()}
                  variant="outline"
                  size="sm"
                  className="border-gray-600 text-gray-300 hover:bg-gray-700 flex-shrink-0"
                >
                  <ImageIcon className="w-4 h-4" />
                </Button>

                <div className="flex-1 relative">
                  <Input
                    value={inputText}
                    onChange={(e) => setInputText(e.target.value)}
                    onKeyPress={handleKeyPress}
                    placeholder="Tanyakan apa saja kepada AI..."
                    className="bg-gray-700 border-gray-600 text-white placeholder-gray-400 pr-12 min-h-[44px] resize-none"
                    disabled={isLoading}
                  />
                </div>

                <Button
                  onClick={sendMessage}
                  disabled={isLoading || (!inputText.trim() && !selectedImage)}
                  className="bg-blue-600 hover:bg-blue-700 text-white flex-shrink-0"
                >
                  <SendIcon className="w-4 h-4" />
                </Button>
              </div>

              <div className="mt-2 text-xs text-gray-500 text-center">
                AI dapat membuat kesalahan. Pastikan untuk memverifikasi informasi penting.
              </div>
            </div>
          </div>
        </div>
      );

      // Render the React component into the root div
      ReactDOM.createRoot(document.getElementById('root')).render(<MainApp />);
    </script>
</body>
</html>
